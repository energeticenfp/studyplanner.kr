<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µë¶€ ê³„íší‘œ ìƒì„±ê¸°</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons for aesthetic (optional, used here for utility icons) -->
    <script type="module">
        import { createIcons, Calendar, Copy, Download, Plus, X, BookOpen, GraduationCap } from 'https://unpkg.com/lucide@latest';
        createIcons({ icons: { Calendar, Copy, Download, Plus, X, BookOpen, GraduationCap } });
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s;
        }
        /* Custom scrollbar for table on smaller screens */
        .overflow-x-auto::-webkit-scrollbar {
            height: 8px;
        }
        .overflow-x-auto::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 10px;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">

    <div id="app" class="max-w-6xl mx-auto">
        <!-- Content will be rendered here -->
    </div>

    <script>
        // --- State Management (ìƒíƒœ ê´€ë¦¬) ---
        let mode = 'normal'; // 'normal' or 'exam'
        let startDate = '';
        let endDate = '';
        let schedule = [];
        let subjects = ['êµ­ì–´', 'ìˆ˜í•™', 'ê³¼í•™', 'ì‚¬íšŒ', 'ì˜ì–´', 'í•œêµ­ì‚¬', 'ì •ë³´'];
        let newSubject = '';

        const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ']; // 0: ì¼ìš”ì¼, 1: ì›”ìš”ì¼ ...

        let weekdaySubjects = {
            1: 'êµ­ì–´', // ì›”
            2: 'ì‚¬íšŒ', // í™”
            3: 'ìˆ˜í•™', // ìˆ˜
            4: 'ê³¼í•™', // ëª©
            5: 'ì˜ì–´', // ê¸ˆ
            6: 'í•œêµ­ì‚¬', // í† 
            0: 'ì •ë³´', // ì¼
        };

        let examStartDate = '';
        let examEndDate = '';
        let examSubjects = ['']; // ê³¼ëª© ì„ íƒ

        const appElement = document.getElementById('app');

        // --- Utility Functions (ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜) ---
        const formatDate = (date) => {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        const showAlert = (message) => {
             // Custom simple message display instead of alert()
             const overlay = document.createElement('div');
             overlay.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
             overlay.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
                    <h3 class="text-xl font-bold mb-3 text-gray-800">ì•Œë¦¼</h3>
                    <p class="text-gray-700 mb-6">${message}</p>
                    <button id="alert-ok" class="w-full bg-indigo-600 text-white font-semibold py-2 rounded-lg hover:bg-indigo-700 transition-colors">í™•ì¸</button>
                </div>
             `;
             document.body.appendChild(overlay);

             document.getElementById('alert-ok').addEventListener('click', () => {
                 document.body.removeChild(overlay);
             });
        }


        // --- Event Handlers (ì´ë²¤íŠ¸ ì²˜ë¦¬) ---

        const handleModeChange = (newMode) => {
            mode = newMode;
            schedule = []; // ëª¨ë“œ ë³€ê²½ ì‹œ ê³„íší‘œ ì´ˆê¸°í™”
            renderApp();
        };

        const handleAddSubject = () => {
            if (newSubject.trim() && !subjects.includes(newSubject.trim())) {
                subjects = [...subjects, newSubject.trim()];
                newSubject = '';
                renderApp();
            }
        };

        const handleRemoveSubject = (subjectToRemove) => {
            subjects = subjects.filter(s => s !== subjectToRemove);
            // ìš”ì¼ë³„ ê³¼ëª©ì—ì„œ ì œê±°ëœ ê³¼ëª©ì´ ìˆë‹¤ë©´ 'êµ­ì–´'ë¡œ ëŒ€ì²´ (ê¸°ë³¸ê°’)
            for (const day in weekdaySubjects) {
                if (weekdaySubjects[day] === subjectToRemove) {
                    weekdaySubjects[day] = subjects.length > 0 ? subjects[0] : '';
                }
            }
            // ì‹œí—˜ ê³¼ëª© ëª©ë¡ì—ì„œë„ ì œê±°
            examSubjects = examSubjects.map(s => s === subjectToRemove ? (subjects.length > 0 ? subjects[0] : '') : s);
            renderApp();
        };

        const handleUpdateWeekdaySubject = (day, value) => {
            weekdaySubjects = { ...weekdaySubjects, [day]: value };
            renderApp();
        };

        const handleAddExamSubject = () => {
            examSubjects = [...examSubjects, subjects.length > 0 ? subjects[0] : ''];
            renderApp();
        };

        const handleRemoveExamSubject = (indexToRemove) => {
            examSubjects = examSubjects.filter((_, i) => i !== indexToRemove);
            if (examSubjects.length === 0) examSubjects = ['']; // ìµœì†Œ 1ê°œ ìœ ì§€
            renderApp();
        };

        const handleUpdateExamSubject = (index, value) => {
            examSubjects[index] = value;
            renderApp();
        };

        const copyToClipboard = () => {
            let text = mode === 'normal'
                ? 'ë‚ ì§œ\tìš”ì¼\tê³¼ëª©\n'
                : 'ë‚ ì§œ\tìš”ì¼\tê³¼ëª©\tD-Day\n';

            schedule.forEach(item => {
                if (mode === 'normal') {
                    text += `${formatDate(item.date)}\t${item.dayOfWeek}\t${item.subject}\n`;
                } else {
                    const dday = item.dDay || (item.isExam ? 'ì‹œí—˜ì¼' : '');
                    text += `${formatDate(item.date)}\t${item.dayOfWeek}\t${item.subject}\t${dday}\n`;
                }
            });

            // navigator.clipboard.writeText()ëŠ” iframe í™˜ê²½ì—ì„œ ì œí•œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ document.execCommand('copy')ë¥¼ ì‚¬ìš©
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed'; // í™”ë©´ì—ì„œ ë³´ì´ì§€ ì•Šë„ë¡
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showAlert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ë…¸ì…˜ í‘œì— ë¶™ì—¬ë„£ê¸°(Ctrl+V) í•˜ì„¸ìš”.');
                } else {
                    showAlert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
                }
            } catch (err) {
                showAlert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
            }
            document.body.removeChild(textarea);
        };

        const downloadCSV = () => {
            let csv = mode === 'normal'
                ? 'ë‚ ì§œ,ìš”ì¼,ê³¼ëª©\n'
                : 'ë‚ ì§œ,ìš”ì¼,ê³¼ëª©,D-Day\n';

            schedule.forEach(item => {
                // CSVì—ì„œ ì‰¼í‘œ(,)ê°€ í¬í•¨ëœ ê³¼ëª©ëª…ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì´ì¤‘ ë”°ì˜´í‘œë¡œ ê°ì‹¸ëŠ” ê²ƒì´ ì¢‹ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬
                const subject = item.subject.replace(/"/g, '""'); // ë”°ì˜´í‘œ ì´ìŠ¤ì¼€ì´í”„
                if (mode === 'normal') {
                    csv += `${formatDate(item.date)},${item.dayOfWeek},"${subject}"\n`;
                } else {
                    const dday = item.dDay || (item.isExam ? 'ì‹œí—˜ì¼' : '');
                    csv += `${formatDate(item.date)},${item.dayOfWeek},"${subject}",${dday}\n`;
                }
            });

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = mode === 'normal' ? 'í‰ì†Œê³„íší‘œ.csv' : 'ì‹œí—˜ê³„íší‘œ.csv';
            link.click();
        };

        // --- Schedule Generation Logic (ê³„íší‘œ ìƒì„± ë¡œì§) ---

        const generateNormalSchedule = () => {
            if (!startDate || !endDate) {
                showAlert('ì‹œì‘ ë‚ ì§œì™€ ì¢…ë£Œ ë‚ ì§œë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            const start = new Date(startDate);
            const end = new Date(endDate);

            if (start > end) {
                showAlert('ì‹œì‘ ë‚ ì§œê°€ ì¢…ë£Œ ë‚ ì§œë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤!');
                return;
            }

            const scheduleData = [];
            let currentDate = new Date(start);

            while (currentDate <= end) {
                const dayOfWeek = currentDate.getDay(); // 0 (ì¼) ~ 6 (í† )
                const subject = weekdaySubjects[dayOfWeek];

                scheduleData.push({
                    date: new Date(currentDate),
                    dayOfWeek: dayNames[dayOfWeek],
                    subject: subject || '-'
                });

                currentDate.setDate(currentDate.getDate() + 1);
            }

            schedule = scheduleData;
            renderApp();
        };

        const generateExamSchedule = () => {
            if (!startDate || !endDate || !examStartDate || !examEndDate) {
                showAlert('ëª¨ë“  ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            const validExamSubjects = examSubjects.filter(s => s.trim() !== '');
            if (validExamSubjects.length === 0) {
                showAlert('ì‹œí—˜ ê³¼ëª©ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            const start = new Date(startDate);
            const end = new Date(endDate);
            const examStart = new Date(examStartDate);
            const examEnd = new Date(examEndDate);

            if (start > end) {
                showAlert('ê³„íší‘œ ì‹œì‘ ë‚ ì§œê°€ ì¢…ë£Œ ë‚ ì§œë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤!');
                return;
            }

            if (examStart > examEnd) {
                showAlert('ì‹œí—˜ ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤!');
                return;
            }

            // ì‹œí—˜ ê¸°ê°„ì˜ ê° ë‚ ì§œë³„ ê³¼ëª© ë§¤í•‘ (ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ)
            const examDaysMap = new Map();
            let examDate = new Date(examStart);
            let subjectIndex = 0;

            while (examDate <= examEnd) {
                if (subjectIndex < validExamSubjects.length) {
                    examDaysMap.set(formatDate(examDate), validExamSubjects[subjectIndex]);
                    subjectIndex++;
                }
                examDate.setDate(examDate.getDate() + 1);
            }

            const scheduleData = [];
            let currentDate = new Date(start);

            while (currentDate <= end) {
                const dayOfWeek = currentDate.getDay();
                const dateString = formatDate(currentDate);
                const item = {
                    date: new Date(currentDate),
                    dayOfWeek: dayNames[dayOfWeek],
                    subject: '-',
                    dDay: null,
                    isExam: false
                };

                // 1. ì‹œí—˜ ë‹¹ì¼ ì²˜ë¦¬
                if (examDaysMap.has(dateString)) {
                    item.subject = `ğŸ”¥ ${examDaysMap.get(dateString)} ì‹œí—˜`;
                    item.isExam = true;
                } else {
                    // 2. ì‹œí—˜ì¼ë¡œë¶€í„° D-Day ê³„ì‚°
                    const daysUntilExamEnd = Math.floor((examEnd.getTime() - currentDate.getTime()) / (1000 * 60 * 60 * 24));

                    if (daysUntilExamEnd >= 0) {
                        // ì‹œí—˜ ì „ (ì‹œí—˜ ì¢…ë£Œì¼ í¬í•¨)
                        const totalExamDays = examDaysMap.size;
                        if (totalExamDays > 0) {
                            // D-Day ê¸°ì¤€ìœ¼ë¡œ ì—­ìˆœìœ¼ë¡œ ê³¼ëª© ë°°ì •
                            // D-Dayê°€ 1ì¼ ì „ (ì‹œí—˜ ì „ë‚ ) -> ë§ˆì§€ë§‰ ì‹œí—˜ ê³¼ëª© ê³µë¶€
                            // D-Dayê°€ 2ì¼ ì „ -> ë§ˆì§€ë§‰ì—ì„œ ë‘ ë²ˆì§¸ ì‹œí—˜ ê³¼ëª© ê³µë¶€
                            const indexToStudy = (daysUntilExamEnd - 1) % totalExamDays;
                            const assignedSubject = validExamSubjects[(totalExamDays - 1 - indexToStudy + totalExamDays) % totalExamDays] || '-';

                            item.subject = assignedSubject;
                            item.dDay = `D-${daysUntilExamEnd}`;
                        } else {
                            item.subject = 'ì‹œí—˜ ê³¼ëª© ì—†ìŒ';
                        }

                    } else {
                        // 3. ì‹œí—˜ í›„
                        item.subject = 'ì‹œí—˜ ì¢…ë£Œ';
                        item.dDay = `D+${Math.abs(daysUntilExamEnd)}`;
                    }
                }

                scheduleData.push(item);
                currentDate.setDate(currentDate.getDate() + 1);
            }

            schedule = scheduleData;
            renderApp();
        };

        // --- Rendering Functions (ë Œë”ë§ í•¨ìˆ˜) ---

        const renderSubjectManagement = () => {
            return `
                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-3">ê³¼ëª© ê´€ë¦¬</h3>
                    <div class="flex gap-2 mb-3">
                        <input
                            type="text"
                            id="newSubjectInput"
                            value="${newSubject}"
                            oninput="newSubject = this.value; renderApp('subjectInput')"
                            onkeypress="if(event.key === 'Enter') { handleAddSubject(); }"
                            placeholder="ìƒˆ ê³¼ëª© ì…ë ¥"
                            class="flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none"
                        />
                        <button
                            onclick="handleAddSubject()"
                            class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center gap-2 transition-colors"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            ì¶”ê°€
                        </button>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        ${subjects.map(subject => `
                            <div key="${subject}" class="flex items-center gap-2 px-3 py-1 bg-white rounded-full border border-gray-300 shadow-sm">
                                <span class="text-sm">${subject}</span>
                                <button
                                    onclick="handleRemoveSubject('${subject}')"
                                    class="text-red-500 hover:text-red-700 transition-colors p-0.5"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        };

        const renderNormalSettings = () => {
            return `
                <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-3">ìš”ì¼ë³„ ê³¼ëª© ì„¤ì •</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        ${[1, 2, 3, 4, 5, 6, 0].map(day => `
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    ${dayNames[day]}ìš”ì¼
                                </label>
                                <select
                                    onchange="handleUpdateWeekdaySubject(${day}, this.value)"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm"
                                >
                                    ${subjects.map(subject => `
                                        <option value="${subject}" ${weekdaySubjects[day] === subject ? 'selected' : ''}>${subject}</option>
                                    `).join('')}
                                </select>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ì‹œì‘ ë‚ ì§œ</label>
                        <input
                            type="date"
                            value="${startDate}"
                            onchange="startDate = this.value; renderApp()"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ì¢…ë£Œ ë‚ ì§œ</label>
                        <input
                            type="date"
                            value="${endDate}"
                            onchange="endDate = this.value; renderApp()"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                        />
                    </div>
                </div>

                <button
                    onclick="generateNormalSchedule()"
                    class="w-full bg-blue-600 text-white font-semibold py-4 rounded-lg hover:bg-blue-700 transition-colors shadow-lg shadow-blue-200/50"
                >
                    í‰ì†Œ ê³„íší‘œ ìƒì„±
                </button>
            `;
        };

        const renderExamSettings = () => {
            return `
                <div class="mb-6 p-4 bg-purple-50 rounded-lg">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-semibold text-gray-800">ì‹œí—˜ ê³¼ëª© ìˆœì„œ (ì‹œí—˜ ì²«ë‚ ë¶€í„°)</h3>
                        <button
                            onclick="handleAddExamSubject()"
                            class="px-3 py-1 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-1 text-sm transition-colors"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            ê³¼ëª© ì¶”ê°€
                        </button>
                    </div>
                    <div class="space-y-2">
                        ${examSubjects.map((subject, index) => `
                            <div key="${index}" class="flex items-center gap-2">
                                <span class="text-sm font-medium text-gray-600 w-16 shrink-0">
                                    ${index + 1}ì¼ì°¨
                                </span>
                                <select
                                    onchange="handleUpdateExamSubject(${index}, this.value)"
                                    class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"
                                >
                                    <option value="" ${subject === '' ? 'selected' : ''}>ê³¼ëª© ì„ íƒ</option>
                                    ${subjects.map(s => `
                                        <option value="${s}" ${subject === s ? 'selected' : ''}>${s}</option>
                                    `).join('')}
                                </select>
                                ${examSubjects.length > 1 ? `
                                    <button
                                        onclick="handleRemoveExamSubject(${index})"
                                        class="text-red-500 hover:text-red-700 transition-colors p-0.5 shrink-0"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ì‹œí—˜ ì‹œì‘ì¼</label>
                        <input
                            type="date"
                            value="${examStartDate}"
                            onchange="examStartDate = this.value; renderApp()"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ì‹œí—˜ ì¢…ë£Œì¼</label>
                        <input
                            type="date"
                            value="${examEndDate}"
                            onchange="examEndDate = this.value; renderApp()"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"
                        />
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ê³„íší‘œ ì‹œì‘ì¼</label>
                        <input
                            type="date"
                            value="${startDate}"
                            onchange="startDate = this.value; renderApp()"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ê³„íší‘œ ì¢…ë£Œì¼</label>
                        <input
                            type="date"
                            value="${endDate}"
                            onchange="endDate = this.value; renderApp()"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"
                        />
                    </div>
                </div>

                <button
                    onclick="generateExamSchedule()"
                    class="w-full bg-purple-600 text-white font-semibold py-4 rounded-lg hover:bg-purple-700 transition-colors shadow-lg shadow-purple-200/50"
                >
                    ì‹œí—˜ ê³„íší‘œ ìƒì„±
                </button>
            `;
        };

        const renderScheduleTable = () => {
            if (schedule.length === 0) return '';

            return `
                <div class="bg-white rounded-2xl shadow-xl p-8 mt-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 border-b pb-4">
                        <h2 class="text-2xl font-bold text-gray-800 mb-3 sm:mb-0">
                            ìƒì„±ëœ ê³„íší‘œ (${schedule.length}ì¼)
                        </h2>
                        <div class="flex gap-3">
                            <button
                                onclick="copyToClipboard()"
                                class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                ë³µì‚¬
                            </button>
                            <button
                                onclick="downloadCSV()"
                                class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-md"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                CSV
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-inner">
                        <table class="w-full whitespace-nowrap">
                            <thead>
                                <tr class="bg-gray-50 border-b border-gray-200">
                                    <th class="px-4 py-3 text-left font-semibold text-gray-700 w-2/12">ë‚ ì§œ</th>
                                    <th class="px-4 py-3 text-left font-semibold text-gray-700 w-1/12">ìš”ì¼</th>
                                    <th class="px-4 py-3 text-left font-semibold text-gray-700 w-6/12">ê³¼ëª©</th>
                                    ${mode === 'exam' ? `
                                        <th class="px-4 py-3 text-left font-semibold text-gray-700 w-3/12">D-Day</th>
                                    ` : ''}
                                </tr>
                            </thead>
                            <tbody>
                                ${schedule.map((item, index) => `
                                    <tr class="border-b last:border-b-0 hover:bg-gray-50 ${item.isExam ? 'bg-yellow-50/70 border-yellow-200' : 'border-gray-100'}">
                                        <td class="px-4 py-3 text-gray-600">${formatDate(item.date)}</td>
                                        <td class="px-4 py-3">
                                            <span class="inline-block px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-medium">
                                                ${item.dayOfWeek}
                                            </span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <span class="inline-block px-3 py-1 rounded-full text-sm font-medium ${
                                                item.isExam
                                                    ? 'bg-red-100 text-red-700 ring-2 ring-red-300'
                                                    : 'bg-blue-100 text-blue-700'
                                            }">
                                                ${item.subject}
                                            </span>
                                        </td>
                                        ${mode === 'exam' ? `
                                            <td class="px-4 py-3">
                                                ${item.dDay ? `
                                                    <span class="inline-block px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium">
                                                        ${item.dDay}
                                                    </span>
                                                ` : ''}
                                                ${item.isExam ? `
                                                    <span class="inline-block px-3 py-1 bg-yellow-200 text-yellow-800 rounded-full text-xs font-medium">
                                                        ì‹œí—˜ì¼
                                                    </span>
                                                ` : ''}
                                            </td>
                                        ` : ''}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-xl">
                        <p class="text-sm text-gray-700">
                            ğŸ’¡ <strong>ë…¸ì…˜ì— ë¶™ì—¬ë„£ê¸°:</strong> "ë³µì‚¬" ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„, ë…¸ì…˜ í‘œì—ì„œ ì²« ë²ˆì§¸ ì…€ì„ ì„ íƒí•˜ê³  <kbd>Ctrl</kbd>+<kbd>V</kbd> ë˜ëŠ” <kbd>Cmd</kbd>+<kbd>V</kbd>ë¥¼ ëˆ„ë¥´ì„¸ìš”.
                        </p>
                    </div>
                </div>
            `;
        };


        const renderApp = (focusElementId = null) => {
            const modeConfig = {
                normal: { color: 'blue', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`, title: 'í‰ì†Œ ëª¨ë“œ', desc: 'ìš”ì¼ë³„ ê³¼ëª© ë°°ì •' },
                exam: { color: 'purple', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v4"/><path d="M12 15V4"/><path d="M22 10c0 5.5-4 9-10 9s-10-3.5-10-9c.07 2.11 1.7 4.14 4 5.38"/><polyline points="15 13 12 16 9 13"/></svg>`, title: 'ì‹œí—˜ ëª¨ë“œ', desc: 'ì‹œí—˜ ëŒ€ë¹„ ê³„íší‘œ' },
            };

            const currentConfig = modeConfig[mode];

            let html = `
                <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">ê³µë¶€ ê³„íší‘œ ìƒì„±ê¸°</h1>

                    <!-- ëª¨ë“œ ì„ íƒ -->
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <button
                            onclick="handleModeChange('normal')"
                            class="p-6 rounded-xl border-2 transition-all shadow-md ${
                                mode === 'normal'
                                    ? 'border-blue-500 bg-blue-50'
                                    : 'border-gray-200 hover:border-blue-300'
                            }"
                        >
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-6 h-6 ${mode === 'normal' ? 'text-blue-600' : 'text-gray-600'}">
                                    ${modeConfig.normal.icon}
                                </div>
                                <h3 class="text-xl font-bold">í‰ì†Œ ëª¨ë“œ</h3>
                            </div>
                            <p class="text-sm text-gray-600">${modeConfig.normal.desc}</p>
                        </button>

                        <button
                            onclick="handleModeChange('exam')"
                            class="p-6 rounded-xl border-2 transition-all shadow-md ${
                                mode === 'exam'
                                    ? 'border-purple-500 bg-purple-50'
                                    : 'border-gray-200 hover:border-purple-300'
                            }"
                        >
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-6 h-6 ${mode === 'exam' ? 'text-purple-600' : 'text-gray-600'}">
                                    ${modeConfig.exam.icon}
                                </div>
                                <h3 class="text-xl font-bold">ì‹œí—˜ ëª¨ë“œ</h3>
                            </div>
                            <p class="text-sm text-gray-600">${modeConfig.exam.desc}</p>
                        </button>
                    </div>

                    ${renderSubjectManagement()}

                    ${mode === 'normal' ? renderNormalSettings() : renderExamSettings()}
                </div>

                ${renderScheduleTable()}
            `;

            appElement.innerHTML = html;

            // Input ê°’ ìˆ˜ë™ ì¬ì„¤ì • ë° í¬ì»¤ìŠ¤ (innerHTML ì‚¬ìš©ìœ¼ë¡œ ì¸í•œ ë¬¸ì œ í•´ê²°)
            document.getElementById('newSubjectInput').value = newSubject;
            if (focusElementId) {
                document.getElementById(focusElementId)?.focus();
            }
        };

        // ì´ˆê¸° ë¡œë“œ
        window.onload = () => {
            renderApp();
            // ì…ë ¥ í•„ë“œì™€ ìƒíƒœ ë™ê¸°í™”ë¥¼ ìœ„í•´ ì´ˆê¸° í•œ ë²ˆ ë” ì‹¤í–‰
            setTimeout(() => {
                document.getElementById('newSubjectInput').value = newSubject;
            }, 0);
        };
    </script>
</body>
</html>
